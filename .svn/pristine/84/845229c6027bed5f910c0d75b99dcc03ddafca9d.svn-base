//è·å–æœ¬åœ°åŒ–æ•°æ®
import config from '../../config';
var util = require('../../utils/util.js');
var MD5 = require('../../utils/md5.js');
var base64 = require('../../utils/base64.js');
var fightUtil = require('../../utils/freeFightCutdown.js');
var showHongBao = require('../../utils/showNewuserHongbao.js');
var WxNotificationCenter = require("../../utils/WxNotificationCenter.js");
var app = getApp();
var isload;             //æ˜¯å¦æ–°åŠ è½½ç•Œé¢
var isCrazyMon = false; //æ˜¯å¦æ˜¯ç–¯ç‹‚æ˜ŸæœŸä¸€
var isautoSign = false; //æ˜¯å¦è‡ªåŠ¨è·³è½¬åˆ°èµšé’±é¡µ
var scrollTop = false;  //æ˜¯å¦æ»‘åŠ¨åˆ°é¡¶éƒ¨
var isActiveShop = true;//æ˜¯å¦æ´»åŠ¨å•†å“
var loginCount;
var rate = 0; //åˆ†è¾¨è½¬æ¢
var floatTop = 0; //æ‚¬æµ®é«˜åº¦
var formId;   //æˆæƒformId
var total_micro_second;//çº¢åŒ…å‰©ä½™æ—¶é—´
var animationTimer;
var xuanfuanimationTimer;
var scene ;
var redhongbaopopTimer;
var redhongbaoCutdoenTimer;
var firstComming;
var urlcomefrom;
Page({
  data: {
    aph: 0,
    lastX: 0,
    lastY: 0,
    shopcode: 0,
    upyconfig: config.Upyun,
    UpyunConfig: config.Upyun,
    newarr: [],
    pageData: [],
    currentpage: 1,
    Upyun: config.Upyun,
    isShowMakeMoney: true,
    isShareFlag: false,
    user_id: "",
    Coloropacity: 1,
    reduceMoney:0,

    uppertittle: "æ¸©é¦¨æç¤º",
    isUpperNotitle: true,
    loginupperdistribution: "éœ€è¦æ‚¨çš„æˆæƒæ‰èƒ½æ­£å¸¸ä½¿ç”¨å“¦ï¼",
    loginupperbuttontitle: "æˆæƒç™»å½•",
    upperGoYiFuShow: false,
    openYifuDialogShow: false,
    openFightSuccessShow: false,
    getHongBaoSuccessShow:false,
    isQRcodeYiFuShow:false,
    redHongbaoQRcodeYiFuShow:false,
    redHongbaoNewuserShow:false,
    typePageHide: app.globalData.typePageHide,
    contactkefuShow:false,
    moneyDiscountShowFlag: false,
    moneyDiscount: "0.0",//ç´¯è®¡å·²æŠµæ‰£çš„ä½™é¢
    oneYuanDiscriptionTitle: "å…è´¹é¢†æœªæˆåŠŸé€šçŸ¥",
    coupon:"6",//ä¼˜æƒ åˆ¸
    roll_code:'',//å‚å›¢å›¢å·
    isFirst: "",
    isNew: "",

    redHongBaoImg: config.Upyun + 'small-iconImages/heboImg/free_199yuancoupon.png!450',
    SmallRedHongBao: config.Upyun + 'small-iconImages/heboImg/small-signRedHongBao.png',

    orderlist: ["é¦–é¡µ", "è´­ç‰©", "æˆ‘çš„"],
    pathlist: ["shouye", "../../pages/shopType/shopType", "../../pages/mine/mine"],
    orderimage: ["../../iconImages/tarbarImages/icon_home.png", "../../iconImages/tarbarImages/icon_shoping_normal.png", "../../iconImages/tarbarImages/icon_wode_normal.png"],

    // è®¾ç½®tabçš„æ•°é‡
    tabs: [
      // { id: "news", isSelect: true, title: "æ—¶å°š" },
      // { id: "hall", isSelect: false, title: "ç”Ÿæ´»" }
    ], //tabbaræ•°ç»„
    curTabId: "news", //å½“å‰tabid
    isShowFloatTab: false, //æ˜¯å¦æ˜¾ç¤ºæ‚¬æµ®tab
    shouYePage:"",    //ThreePage é¦–é¡µ3 ï¼›FourPage é¦–é¡µ4 FivePage é¦–é¡µ5
    scrollTop: 0,
    is_shouTime:false,
    load_timer: true,//å®šæ—¶å™¨
    clock_hr: '00',//æ—¶
    clock_min: '00',//åˆ†
    clock_ss: '00',//ç§’
    clickLogin: true,//ç‚¹å‡»çº¢åŒ…æˆæƒ

    hideModal: true, //æ¨¡æ€æ¡†çš„çŠ¶æ€  true-éšè—  false-æ˜¾ç¤º
    animationData: {},
    length: 0,
    secondimgData: ['complaint_1.png', 'complaint_2.png', 'complaint_3.png'],
    secondtextData: ['å‘é€ç»™æœ‹å‹', 'æ·»åŠ åˆ°æˆ‘çš„å°ç¨‹åº', 'æ·»åŠ åˆ°æ¡Œé¢'],
    thirdimgData: ['complaint_4.png', 'complaint_5.png', 'complaint_6.png', 'complaint_7.png'],
    thirdtextData: ['æµ®çª—', 'è®¾ç½®', 'åé¦ˆä¸æŠ•è¯‰', 'é‡æ–°è¿›å…¥å°ç¨‹åº'],
    pagestyle: 2,
  },

  onLoad: function (options) {
    loginCount = 0;
    firstComming = true;
    var that = this;
    if (!app.parent_id) {
      app.parent_id = options.user_id;
    }

    if(options){
      //è¿›å…¥çš„æ¸ é“
      if (options.adventpage) {
        wx.setStorageSync("advent_channel", '68' + options.adventpage);
      }
      //å­˜å‚¨å¾®ä¿¡å¹¿å‘ŠID
      if (options.gdt_vid) {
        wx.setStorageSync("gdt_vid", options.gdt_vid);
      }
      //èµšé’±ä»»åŠ¡è¿›æ¥çš„
      if (options.comefrom) {
        this.setData({
          task_freeling: 'freeling'
        })
      }
      if (options.testShare)
      {
        this.data.testShare = options.testShare;
      }
      if(options.comefrom){
        this.data.comefrom = options.comefrom
      }
      if (app.globalData.channel_type == 1) {
        this.setData({
          channel_type: app.globalData.channel_type
        })
      }
      var changTabs = [];

      //ç¡®å®šæ˜¯ç”¨é¦–é¡µ3 è¿˜æ˜¯é¦–é¡µ5
      var shouyePage = options.shouYePage == "ThreePage" ? 'FivePage' : options.shouYePage
      scene = options.scene != undefined? options.scene:'';
      //æ‰«ç çº¢åŒ…
      if (options.scene) {
        const scenea = decodeURIComponent(options.scene)
        var scenedata = scenea.split(',');
        if (scenedata.length == 3) {
          var user_id = scenedata[0];
          var shoyType = scenedata[2];
          shouyePage = 'FivePage';

          //å¦‚æœæ˜¯æ‰«ç è¿›æ¥å¼¹æ¡†
          if (shoyType == 'QRcode') {
            this.setData({
              isQRcodeYiFuShow:true,
              redHongbaoQRcodeYiFuShow: true
            })
          }

          //ä¿å­˜çˆ¶ID
          if (!app.parent_id) {
            app.parent_id = user_id;
          }
        }
      } else {
        // var that = this;
        // showHongBao.getShowHongbao(that, function (is_show) {
        //   if (is_show) {
        //     that.setData({
        //       redHongbaoNewuserShow: true
        //     })
        //   }
        // });
      }

      if (shouyePage == "ThreePage"){
        changTabs = [
          { id: "news", isSelect: true, title: "æ–°äººå…è´¹ç¦åˆ©" },
        ];
      } else if (shouyePage == "FourPage"){
        changTabs = [
          { id: "hall", isSelect: true, title: "æ–°äººé’œæƒ " },
        ];
      } else if (shouyePage == "FivePage"){
        changTabs = [
          { id: "news", isSelect: true, title: "æ–°äººé’œæƒ " },
        ];
      }
      else{
        changTabs = [
          { id: "news", isSelect: true, title: "æ—¶å°š" },
          { id: "hall", isSelect: false, title: "ç”Ÿæ´»" }
        ];
      }

      setTimeout(function () {
        total_micro_second = 30 * 60 * 1000;
        that.countdown();
        that.setData({
          is_shouTime: true
        })
      }, 1000);
      
      var showFootView = app.globalData.first_diamond == 1?false:true; 
      that.setData({
        curTabId:changTabs[0].id,
        tabs: changTabs,
        shouYePage: shouyePage,
        roll_code: options.roll_code != undefined ? options.roll_code :"",
        isFirst: (options.isFirst != undefined && options.isFirst != null) ? options.isFirst:"",
        isNew: (options.isNew != undefined && options.isNew != null)? options.isNew : "",
        showFootView: showFootView
        // coupon: options.coupon,
        // getHongBaoSuccessShow:true
      })


    }

    //æ¸…ç©ºèµšé’±åˆ†é’Ÿç›¸å…³æ•°æ®
    wx.setStorageSync("SIGN-TASK-MM", "");
    wx.setStorageSync("MIN_BEGIN_MIN_INDEX", "");
    wx.setStorageSync("MIN_BEGIN_MIN_ETime", "");
    wx.setStorageSync("countdownUseED", false)

    ////////////////////
    new app.ToastPannel();
    this.oneYuan_httpData();
    this.top_shopHttp();
    this.getScrollTop();
    this.getcoupon_http();
    this.hongBaoAnimation();
    
    isload = true;
    var that = this;
    setTimeout(function () {
      console.log("2222222222222222222222222222", options.user_id);
      if (options.isShareFlag || options.user_id) {
        // app.shareToHomepage3()

        that.setData({
          isShareFlag: options.isShareFlag,
          user_id: options.user_id,
        })
      }
      var loginfinish = wx.getStorageSync("loginfinish")
    }, 500);

    setTimeout(function(){
      if (app.globalData.first_diamond == 1) {
        that.setData({
          freelingShowTips: true
        })
      }
    },2000)
    
    WxNotificationCenter.addNotification("testNotificationItem1Name", this.testNotificationFromItem1Fn, this);

  },
  onUnload() {
    clearTimeout(redhongbaopopTimer);//æ¸…é™¤å®šæ—¶å™¨
    clearTimeout(redhongbaoCutdoenTimer);
    this.setData({
      load_timer: false,
    })
  },
  
  //å¼€å±çº¢åŒ…
  kaiPingHongBaoShow:function(){
    var that = this;
    //è·å–æ˜¯å¦æ˜¯ä¼šå‘˜
    util.get_vip(function (data) {
      var isVip = data.isVip != undefined ? data.isVip : 0; //0ä¸æ˜¯ 1æ˜¯
      if (isVip == 0)//ä¸æ˜¯ä¼šå‘˜
      {
        //éæ–°äººéä¼šå‘˜ æç°ä½™é¢
        if (!app.globalData.user.firstLogin)//éæ–°äºº
        {
          if (that.data.nRaffle_Money > 0) {
            var cutdowntime = 24 * 60 * 60 * 1000;
            fightUtil.countdown(that, fightUtil, cutdowntime, function (data) {
              that.setData({
                is_fresh: true,
                time: data
              })
            })

            that.setData({
              upperGoYiFuShow_tixian: true
            })
            return;
          } else if (that.data.nRaffle_Money == 0) {
            that.setData({
              upperGoYiFuShow_task: true
            })
            return;
          }
        }

        showHongBao.getShowHongbao(that, function (is_show) {
          if (is_show) {
            that.setData({
              redHongbaoNewuserShow: true
            })
          }
        });

      } else {
        that.setData({
          hasJYJLdialog: true,
        })
      }
    })
  },
  //ä»»åŠ¡çº¢åŒ…
  signHongBaosubmit: function (e) {
    formId = e.detail.formId;
    if (app.globalData.user != null) {
      util.httpPushFormId(e.detail.formId);
    }
    wx.navigateTo({
      url: '../sign/sign',
    })
  },

  loginsubmit: function (e) {
    formId = e.detail.formId;
    if(app.globalData.user != null)
    {
      util.httpPushFormId(e.detail.formId);
    }
    
    this.setData({
      upperGoYiFuShow: false,
    })
  },
  
  xianjinRedsubmit: function (e) {
    var formId = e.detail.formId;
    if (formId && app.globalData.user != null) {
      util.httpPushFormId(formId);

      this.setData({
        redHongbaoQRcodeYiFuShow: false,
        isQRcodeYiFuShow: false
      })

      clearInterval(animationTimer);
    }

    if (this.data.redHongbaoNewuserShow) {

      if (app.globalData.channel_type == 1)//æ¸ é“è¿›å…¥
      {
        this.setData({
          redHongbaoNewuserShow: false
        })
      } else {
        if (app.globalData.user != null && app.globalData.user.userToken != undefined) {
          this.setData({
            redHongbaoNewuserShow: false
          })
        }
      }
      showHongBao.clickHongbao(this, function (is_show) { })
    } else if (this.data.upperGoYiFuShow_task) {
      this.setData({
        upperGoYiFuShow_task: false,
      })
      showHongBao.clickHongbao(this, function (is_show) { })
    } else if (this.data.upperGoYiFuShow_tixian) {
      this.setData({
        upperGoYiFuShow_tixian: false
      })
      wx.navigateTo({
        url: '/pages/mine/withdrawLimitTwo/withdrawLimitTwo'
      })
    }
  },
  //æˆæƒå¼¹çª—
  onclick: function (e) {
    var that = this;
    wx.getUserInfo({
      //å…è®¸æˆæƒ è·å–ç”¨æˆ·ä¿¡æ¯
      success: function (res) {
        if (!app.globalData.user) {
          wx.showLoading({
            title: 'è¯·ç¨å',
            mask: true,
          })
          //æˆæƒæˆåŠŸå»ç™»å½•
          app.New_userlogin(function (data) {
            wx.hideLoading();
            if (app.globalData.user && app.globalData.user.userToken != undefined)//ç™»å½•æˆåŠŸ
            {
              that.setData({
                redHongbaoQRcodeYiFuShow: false,
                isQRcodeYiFuShow: false
              })
              if (that.data.showendofpromotionDialog) {
                wx.setStorageSync("comefrom", 'showendofpromotionDialog_free');
                wx.switchTab({
                  url: '/pages/shouye/shouye?comefrom=showendofpromotionDialog',
                })
              }
            } else {
              that.globalLogin();
            }
          });
        }else{
          if (that.data.showendofpromotionDialog) {
            wx.setStorageSync("comefrom", 'showendofpromotionDialog_free');
            wx.switchTab({
              url: '/pages/shouye/shouye?comefrom=showendofpromotionDialog',
            })
          }
        }
      },
      fail: function () {

      }
    })
  },

  hongbaoclick: function (e) {
    var that = this;
    wx.getUserInfo({
      //å…è®¸æˆæƒ è·å–ç”¨æˆ·ä¿¡æ¯
      success: function (res) {
        if (!app.globalData.user) {
          wx.showLoading({
            title: 'è¯·ç¨å',
            mask: true,
          })
          //æˆæƒæˆåŠŸå»ç™»å½•
          app.New_userlogin(function (data) {
            wx.hideLoading();
            if (app.globalData.user && app.globalData.user.userToken != undefined)//ç™»å½•æˆåŠŸ
            {
              that.setData({
                redHongbaoQRcodeYiFuShow:false,
                isQRcodeYiFuShow: false
              })

            } else {
              that.globalLogin();
            }

            if (that.data.redHongbaoNewuserShow) {
              that.redHongClick();
              that.setData({
                redHongbaoNewuserShow: false
              })
            }
          });
        }
      },
      fail: function () {
        
      }
    })
  },

  //çº¢åŒ…ç‚¹é¢†
  redHongClick: function () {
    //å»æç°
    // wx.navigateTo({
    //   url: '/pages/mine/wallet/wallet?comefrome=tixianstyle',
    // })
    if (app.homePagetoSign == true) {
      wx.navigateTo({
        url: '/pages/sign/sign',
      })
    }
  },

  //è‡ªåŠ¨ç™»å½•
  globalLogin: function () {
    var that = this;
    util.autoLogin(loginCount, function (loginfailYiFuShow, login_discribution, login_buttontitle, newloginCount) {
      wx.hideLoading();
      loginCount = newloginCount;
      if (loginCount == 1)//ç™»å½•æˆåŠŸ
      {
        that.setData({
          redHongbaoQRcodeYiFuShow: false,
          isQRcodeYiFuShow: false
        })
      } else {
        that.setData({
          loginfailYiFuShow: loginfailYiFuShow,
          login_discribution: login_discribution,
          login_buttontitle: login_buttontitle,
        })
      }
    })
  },

  //ç™»å½•å¤±è´¥é‡æ–°ç™»å½•
  loginAgainSubmit: function () {
    var that = this;

    that.setData({
      loginfailYiFuShow: false,
    })
    wx.showLoading({
      title: 'è¯·ç¨å',
    })
    that.globalLogin();
  },
  /**
   * è·å¾—æ»‘åŠ¨å¯¼è‡´æ‚¬æµ®å¼€å§‹çš„é«˜åº¦
   * @return {[type]} [description]
   */
  getScrollTop: function () {
    var that = this;
    if (wx.canIUse('getSystemInfo.success.screenWidth')) {
      wx: wx.getSystemInfo({
        success: function (res) {
          rate = res.screenWidth / 750;
          floatTop = 400 * rate;
          that.setData({
            scrollTop: 400 * res.screenWidth / 750,
            scrollHeight: res.screenHeight / (res.screenWidth / 750) - 128,
          });
        }
      });
    }
  },

  /**
    * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
    */
  onPageScroll: function (event) {
    var scrollTop = event.scrollTop;
    if (scrollTop >= floatTop && !this.data.isShowFloatTab) {
      this.setData({
        isShowFloatTab: true,
      });
    } else if (scrollTop < floatTop && this.data.isShowFloatTab) {
      this.setData({
        isShowFloatTab: false,
      });
    }
  },

  /**
    * ç‚¹å‡»tabåˆ‡æ¢
    * @param  {[type]} event 
    * @return {[type]}       
    */
  clickTab: function (event) {
    var id = event.detail.id;
    this.data.curTabId = id;
    scrollTop = true;

    for (var i = 0; i < this.data.tabs.length; i++) {
      if (id == this.data.tabs[i].id) {
        this.data.tabs[i].isSelect = true;
      } else {
        this.data.tabs[i].isSelect = false;
      }
    }

    this.setData({
      tabs: this.data.tabs,
      curTabId: this.data.curTabId,
      currentpage: 1,
    });

    //æ›´æ–°æ•°æ®ï¼Œç¬¬ä¸€æ¬¡ç‚¹å‡»æˆ–è€…ä¸ºç©ºçš„æ—¶å€™åŠ è½½é‡æ–°åŠ è½½æ•°æ®
    this.http_shoplist();
  },
  
  onHide: function (options) {
    WxNotificationCenter.removeNotification("testNotificationItem1Name", this);
    wx.setStorageSync("loginfinish", "false")
    isload = false;

    clearInterval(xuanfuanimationTimer);
    showHongBao.stoppopTimer(this, function () { })
    this.xuanfuanimationMiddleHeaderItem.rotate(0).step();
    this.setData({
      xuanfuanimationMiddleHeaderItem: this.xuanfuanimationMiddleHeaderItem.export(),  //è¾“å‡ºåŠ¨ç”»
      suspensionHongBao_isShow:false,
      redHongbaoNewuserShow:false
    });
  },

  testNotificationFromItem1Fn: function (info) {
    console.log("!!!!!!!!!!!!isShareFlag=", this.data.isShareFlag);
    //å¦‚æœæ˜¯åˆ†äº«è¿›å…¥çš„ è‡ªåŠ¨è·³è½¬åˆ°èµšé’±é¡µ
    if (this.data.isShareFlag == true) {
      console.log("4444444444444444444444");
      // wx.navigateTo({
      //   url: '../sign/sign?isShareFlag=' + this.data.isShareFlag + "&user_id=" + this.data.user_id,
      // })
    } else {
      console.log("555555555555555555555555");
      //è·³è½¬åˆ°èµšé’±é¡µé¢
      this.http_Landingpage();
      // this.http_shoplist();
    }
  },

  //è¯·æ±‚è½åœ°é¡µ è·å–å¾®ä¿¡å°ç¨‹åºè½åœ°é¡µå¼€å…³
  http_Landingpage: function () {
    var token = "";
    if (app.globalData.user != null) {
      token = app.globalData.user.userToken;
    }
    // wx.showLoading({
    //   mask: true
    // })
    var url = config.Host + 'cfg/getCurrWxcxType?token=' + token + config.Version;
    util.http(url, this.Landingpage);
  },

  Landingpage: function (data) {
    console.log('**************data=', data);
    if (data.status == 1) {
      var shouyecount = data.data;
      console.log('**************shouyecount=', shouyecount);
      if (shouyecount == 0) {
        console.log('**************shouyecount11111=', shouyecount);
        this.setData({
          isShowMakeMoney: false,
        });
      } else {
        console.log('**************shouyecount22222=', shouyecount);
        var that = this;
        setTimeout(function () {
          that.setData({
            isShowMakeMoney: true,
          });
          console.log('**************isShowMakeMoney=', that.data.isShowMakeMoney);
          isautoSign = true;

        }, 500);
      }

      app.globalData.user["shouyecount"] = shouyecount;

      if (shouyecount == 1) {
        // var pages = getCurrentPages();
        // var prevPage = pages[pages.length - 1];
        // if (prevPage.route == "pages/shouye/shouye") {
        // wx.navigateTo({
        //   url: '../sign/sign',
        // })
        // wx.hideLoading();
        // }
      }
    }
    //  else
    // wx.hideLoading();

  },

  //è·å–ä¼˜æƒ åˆ¸
  getcoupon_http:function(){
    var that = this;
    var oldurl = config.Host + '/coupon/getRollCoupon?' + config.Version;
    util.http(oldurl, that.coupon_data);
  },
  coupon_data:function(data){
    var coupon = "6";
    var cond = "10";
    if (data.status == 1) {
      coupon = data.price > 0 ? (data.price*1).toFixed(0) : coupon;
      cond = data.cond > 0 ? (data.cond * 1).toFixed(0) : cond;
    }
    this.setData({
      coupon: coupon,
      cond:cond
    })
  },
  //è½®æ’­æ•°æ®
  top_shopHttp: function () {
    var that = this;
    var oldurl = config.Host + 'shop/queryOption?' + config.Version;
    util.http(oldurl, that.top_shop_data);
  },
  top_shop_data: function (data) {
    if (data.status == 1) {
      var listshop = data.topShops;
      this.setData({
        swiperlist: listshop,
      })
    }
  },
  //è½®æ’­å›¾ç‚¹å‡»äº‹ä»¶
  swipertap: function (event) {
    console.log(event);
    // wx.navigateTo({
    //   url: '../mine/wallet/Withdrawals/Withdrawals?isRed=' + 'true' + '&coupon=' + this.data.coupon + '&cond=' + (20 - this.data.coupon),
    // })
    
    // var item = event.currentTarget.dataset.item;
    // var option_type = item.option_type;
    // var shop_code = item.shop_code;

    // switch (option_type) {
    //   case 1://å•†å“è¯¦æƒ…
    //     wx.navigateTo({
    //       url: '../shouye/detail/detail?' + "shop_code=" + shop_code,
    //     })
    //     break;
    //   case 2://é‚€è¯·ç 
    //     break;
    //   case 3://æ¶ˆæ¯ç›’å­
    //     break;
    //   case 4://ç­¾åˆ°é¡µ
    //     break;
    //   case 5://H5æ´»åŠ¨é¡µ
    //     break;
    //   case 6://æ–°å“ä¸“åŒº
    //     wx.navigateTo({
    //       url: '../shouye/newProductarea/newProductarea',
    //     })
    //     break;
    //   case 7://åˆ¶é€ å•†
    //     this.brandsDetail(item);
    //     break;
    //   case 999://æ–°äººæç°
    //     wx.navigateTo({
    //       url: '../mine/wallet/Withdrawals/Withdrawals?isRed='+'true',
    //     })
    //     break;

    // }
  },

  //åˆ¶é€ å•†è¯¦æƒ…
  brandsDetail: function (item) {
    //è·å–åˆ¶é€ å•†æ•°æ®
    var basesData = wx.getStorageSync("shop_tag_basedata");

    var brandlist = basesData.data.supp_label;
    var branddetail = "";
    for (var i = 0; i < brandlist.length; i++) {
      var brand = brandlist[i];
      if (brand.id == item.shop_code) {
        branddetail = brand;
      }
    }
    if (branddetail != "") {
      var id = branddetail.id;
      var name = branddetail.name;
      var pic = branddetail.pic;
      var remark = branddetail.remark;
      wx.navigateTo({
        url: '../listHome/brandsDetail/brandsDetail?' +
          "class_id=" + id +
          "&navigateTitle=" + name +
          "&brandPic=" + pic +
          "&remark=" + remark
      })
    }
  },

  //è·å–æ˜¯å¦æ˜¯ä¸€å…ƒè´­
  oneYuan_httpData: function () {
    var that = this;
    var url = config.Host + 'cfg/on_off_3_7?' + config.Version;
    util.http(url, that.oneYuanData);
  },
  oneYuanData: function (data) {
    var that = this;
    if (data.status == 1) {
      //data 0ä¸€å…ƒè´­ 1ä¸æ˜¯ä¸€å…ƒè´­
      // app.globalData.oneYuanData = data.data.wxcx_status;
      // app.globalData.typePageHide = data.data.typePageHide != undefined ? data.data.typePageHide:0;
      // app.globalData.oneYuanData = this.data.shouYePage == "FourPage"? 1:0;//é¦–é¡µ4é»˜è®¤ä¸æ˜¯ä¸€å…ƒè´­ æ˜¯æ´»åŠ¨å•†å“
      
      app.globalData.oneYuanData = 0;
      app.globalData.typePageHide = 0;

      util.get_discountHttp(function (data) {
        if (data.status == 1) {
          var money = data.one_not_use_price.toFixed(2);
          var shop_deduction = Number(data.shop_deduction) > 1 ? 1.0 : data.shop_deduction;

          that.setData({
            reduceMoney: money,
            nRaffle_Money: data.nRaffle_Money,
            shop_deduction: shop_deduction != undefined ? shop_deduction : 0.0
          })
        }
        that.http_shoplist();
      });
    }
  },
  //è·å–ç”¨æˆ·æ˜¯å¦æœ‰æ‹¼å›¢æˆåŠŸçš„è®¢å•
  getOrderStatus: function () {
    var that = this;
    var token = "";
    if (app.globalData.user != null) {
      token = app.globalData.user.userToken;
    }
    var oldurl = config.Host + 'order/getOrderStatus?' + config.Version + "&token=" + token;
    util.http(oldurl, that.fightOrder_data);
  },
  fightOrder_data: function (data) {
    var that = this;

    if (data.status == 1 && data.roll == 1) {
      this.setData({
        openFightSuccessShow: true
      })
    } else {//å¦‚æœæ²¡æœ‰å†æŸ¥çœ‹æ˜¯å¦æœ‰é€€æ¬¾
      util.get_discountHttp(that.discountData);
    }
  },

  //çƒ­å–åˆ—è¡¨æ•°æ®
  http_shoplist: function () {
    var that = this;
    var token = "";
    if (app.globalData.user != null) {
      token = app.globalData.user.userToken;
    }

    var typename = 'çƒ­å–';
    var type1 = '1';
    var page = that.data.currentpage;
    var url = "";

    if (that.data.curTabId == 'news')//æ—¶å°š
    {
      if (app.globalData.oneYuanData == 0)//1å…ƒè´­
      {
        //æ­£ä»·å¹¿å‘Šå•†å“
        var tongji_url = "default";
        var tongji_parameter = "default"
        var mUrl = config.Host + 'homePage3shop/dataShopList?' + 'pager.pageSize=30' + '&pager.curPage=' + page;

        if (mUrl) {
          var tepm = mUrl.split("?");
          tongji_url = mUrl.split("?")[0]
          tongji_url = tongji_url.replace(config.Host, "");
          tongji_url = tongji_url.replace(config.PayHost, "")
          tongji_url = tongji_url.replace("//", "/")

          tongji_parameter = mUrl.substring(mUrl.indexOf("?") + 1, mUrl.length - 1)

          if (!tongji_url) {
            tongji_url = "default"
          }
          if (!tongji_parameter) {
            tongji_parameter = "default"
          }
        }

        if(token.length > 10)
        {
          if (app.globalData.first_diamond == 1)
          {
            url = config.Host + 'homePage2FreeShop/dataShopList?' + 'pager.pageSize=30' + '&pager.curPage=' + page + '&token=' + token;
            urlcomefrom = 'homePage2FreeShop';
          }else{
            url = config.Host + 'homePage3shop/dataShopList?' + 'pager.pageSize=30' + '&pager.curPage=' + page + '&token=' + token;
            urlcomefrom = 'homePage3shop';
          }
        }else{
          url = config.Host + 'homePage3shop/dataShopList?' + 'pager.pageSize=30' + '&pager.curPage=' + page ;
        }
        url = util.Md5_httpUrl(url);
        wx.request({
          url: url + config.Version,
          data: {

          },
          header: {
            'content-type': 'application/json' // é»˜è®¤å€¼
          },
          success: function (res) {
            console.log('@@@@@@@@@@@@@@@@@@@@@@@@@' + res.data.listShop);

            app.mtj.trackEvent('i_f_success_count', {
              i_f_name: tongji_url,
            });
            
            var data = res.data;
            app.globalData.first_diamond = data.first_diamond != undefined ? data.first_diamond : 0;
            that.newshoplistData(data);
          },
          fail: function (error) {
            app.mtj.trackEvent('i_f_error_count', {
              i_f_name: tongji_url,
            });
          }
        })
      } else {
        //æ´»åŠ¨å•†å“
        url = config.Host + 'shop/queryShopActivity?' + "æœ€æ–°" + config.Version + '&token=' + token + '&pageSize=30' + '&curPage=' + page;
        util.http(url, that.shoplistData);
      }

    } else {//ç”Ÿæ´»
      //ç‰¹ä»·å¹¿å‘Šå•†å“
      // var url = config.Host + 'shop/queryPackageList?pager.order=desc' + config.Version + '&pager.pageSize=30' + '&pager.curPage=' + page + '&p_type=0';
      var url = config.Host + 'homePage4shop/shopDataList?pager.order=desc' + config.Version + '&token=' + token + '&pager.pageSize=30' + '&pager.curPage=' + page + '&p_type=0';
      util.http(url, that.shoplistData);
    }
  },

  //çƒ­å–å•†å“æ•°æ®å¤„ç†
  newshoplistData: function (data) {
    console.log('@@@@@@@@@@@@@@@@@@@@@@@@@' + data.listShop);
    wx.stopPullDownRefresh();
    if (this.data.currentpage == 1) {
      this.data.shoplist = [];
    }
    if (data.status == 1) {

      var page = this.data.currentpage + 1;
      this.data.currentpage = page;

      var isVip = data.isVip != undefined ? data.isVip : '';
      var maxType = data.maxType != undefined ? data.maxType : '';

      this.data.isVip = isVip;
      this.data.maxType = maxType;

      if (this.data.curTabId == 'news')//æ—¶å°š
      {
        if (app.globalData.oneYuanData == 0)//1å…ƒè´­
        {
          this.remaishoplist(data.listShop);
        } else {
          this.remaishoplist(data.list);
        }
      }

      // if (!this.data.redHongbaoQRcodeYiFuShow)
      // {
      //   this.kaiPingHongBaoShow();
      // }
    } else {
      // this.showToast(data.message, 2000);
    }
  },

  //æ´»åŠ¨å•†å“ ç‰¹ä»·å•†å“å¤„ç†æ•°æ®
  shoplistData: function (data) {
    wx.stopPullDownRefresh();
    if (this.data.currentpage == 1) {
      this.data.shoplist = [];
    }
    if (data.status == 1) {

      var page = this.data.currentpage + 1;
      this.data.currentpage = page;

      var isVip = data.isVip != undefined ? data.isVip : '';
      var maxType = data.maxType != undefined ? data.maxType : '';

      this.data.isVip = isVip;
      this.data.maxType = maxType; 

      if (this.data.curTabId == 'news')//æ—¶å°š
      {
        if (app.globalData.oneYuanData == 0)//1å…ƒè´­
        {
          console.log('æ­£å¸¸å•†å“' + data.listShop);
          this.remaishoplist(data.listShop);
        } else {
          console.log('æ´»åŠ¨å•†å“' + data.list);
          this.remaishoplist(data.list);
        }
      } else {

        var shoplist = [];
        for (var i = 0; i < data.pList.length; i++) {
          // this.remaishoplist(data.pList[i].shop_list, data.pList[i].code, data.pList[i].wxcx_shop_group_price, data.pList[i].def_pic, data.pList[i].shop_se_price);

          var wxcx_shop_group_price = data.pList[i].wxcx_shop_group_price;

          var virtual_sales = data.pList[i].virtual_sales;
          data.pList[i].shop_list[0].virtual_sales = virtual_sales;
          data.pList[i].shop_list[0].def_pic = data.pList[i].def_pic;
          data.pList[i].shop_list[0].shop_se_price = data.pList[i].shop_se_price;
          data.pList[i].shop_list[0].wxcx_shop_group_price = wxcx_shop_group_price;
          shoplist.push(data.pList[i].shop_list[0]);
          console.log(shoplist);
        }
        this.remaishoplist(shoplist, wxcx_shop_group_price);
      }
    } else {
    }
  },

  remaishoplist: function (obj, wxcx_shop_group_price) {

    for (var i = 0; i < obj.length; i++) {
      var new_clde = obj[i].shop_code.substr(1, 3);
      var new_pic = "";
      var shop_code = obj[i].shop_code;
      var newshopname = obj[i].shop_name;
      var shop_se_price = (obj[i].shop_se_price * 1).toFixed(1);

      if (this.data.curTabId == 'news')//æ—¶å°š
      {
        new_pic = new_clde + '/' + obj[i].shop_code + '/' + obj[i].def_pic;
        shop_code = obj[i].shop_code;


        if (app.showSub) {
          if (newshopname.length > 12) {
            newshopname = '... ' + newshopname.substr(newshopname.length - 12, 12);
          }

        } else {
          if (newshopname.length > 24) {
            newshopname = '... ' + newshopname.substr(newshopname.length - 24, 24);
          }
        }

      } else {//ç”Ÿæ´»
        new_pic = obj[i].def_pic;

        if (newshopname.length > 24) {
          newshopname = '... ' + newshopname.substr(newshopname.length - 24, 24);
        }
      }

      obj[i].def_pic = new_pic;
      obj[i].shop_code = shop_code;
      obj[i].shop_name = newshopname;

      if (this.data.currentTab == 0) {
        var discount = (obj[i].shop_se_price / obj[i].shop_price * 9).toFixed(1)
        obj[i]["discount"] = discount;
      }

      if (app.globalData.oneYuanData == 0)//æ˜¯1å…ƒè´­
      {
        var se_price = (obj[i].assmble_price * 1).toFixed(1);

        if (this.data.curTabId != 'news') //ç”Ÿæ´»
        {
          this.data.reduceMoney = this.data.reduceMoney >= 15 ? 15 : this.data.reduceMoney;
          // se_price = shop_se_price - this.data.reduceMoney > 0 ? (shop_se_price - this.data.reduceMoney) : '0.0';

          se_price = util.get_discountPrice(shop_se_price, this.data.shop_deduction, this.data.reduceMoney, this.data.maxType);
        }else{//æ—¶å°š
          if(this.data.isVip > 0)
          {
            // se_price = shop_se_price - this.data.reduceMoney > 0 ? (shop_se_price - this.data.reduceMoney) : '0.0';

            se_price = util.get_discountPrice(shop_se_price, this.data.shop_deduction, this.data.reduceMoney, this.data.maxType);
          }
        }

        obj[i].shop_se_price = (se_price*1).toFixed(1);
        obj[i].shop_price = shop_se_price;
        obj[i]["SupperLab"] = 0;
      } else {
        obj[i].shop_se_price = shop_se_price;
        obj[i]["SupperLab"] = 1;
      }
    }
    var all_shoplists = this.data.shoplist;
    for (var j = 0; j < obj.length; j++) {
      all_shoplists.push(obj[j]);
    }
    //å¦‚æœä¸æ˜¯èµšé’±é¡µ èµšé’±å…¥å£éšè—
    if (app.globalData.oneYuanData == 1 || this.data.curTabId == 'hall') {
      this.setData({
        Coloropacity: "0",
      })
    } else {
      this.setData({
        Coloropacity: "1",
      })
    }
    this.setData({
      shoplist: all_shoplists,
      showSub: app.showSub

    })

    //åˆ‡æ¢åˆ—è¡¨æ—¶ åˆ—è¡¨æ»‘åŠ¨åˆ°é¡¶éƒ¨
    if (scrollTop == true) {
      if (this.data.isShowFloatTab == true) {
        wx.pageScrollTo({
          scrollTop: this.data.scrollTop
        })
        scrollTop = false;
      }
    }
  },

  //åˆ—è¡¨æ•°æ®
  list_shopHttp: function () {
    var that = this;
    var url = config.Host + "collocationShop/queryShopCondition?type=2" + config.Version + '&pager.curPage=' + that.data.currentpage + "&pager.pageSize=10";
    util.http(url, that.collocationShopData);
  },

  collocationShopData: function (data) {
    wx.stopPullDownRefresh();
    if (this.data.currentpage == 1) {
      console.log(data);
      this.setData({
        postlist: [],
        pageData: [],
      })
    }
    if (data.status == 1) {
      var page = this.data.currentpage + 1;
      this.setData({
        currentpage: page,
        tabs: this.data.tabs,
        curTabId: this.data.curTabId,
      })
      var listshop = data.listShop;
      this.newshoplist(listshop);
    } else {
      this.showToast(data.message, 2000);
    }
  },

  //åˆ—è¡¨åŠ è½½æ›´å¤š
  onReachBottom: function () {
    
    var that = this;
    util.get_discountHttp(function (data) {
      if (data.status == 1) {
        var money = data.one_not_use_price.toFixed(2);
        var shop_deduction = Number(data.shop_deduction) > 1 ? 1.0 : data.shop_deduction;
        that.setData({
          reduceMoney: money,
          shop_deduction: shop_deduction != undefined ? shop_deduction : 0.0
        })
      }

      that.http_shoplist();
    });
  },
  //ä¸‹æ‹‰åˆ·æ–°
  onPullDownRefresh: function () {
    
    var that = this;
    util.get_discountHttp(function (data) {
      if (data.status == 1) {
        var money = data.one_not_use_price.toFixed(2);
        var shop_deduction = Number(data.shop_deduction) > 1 ? 1.0 : data.shop_deduction;
        that.setData({
          reduceMoney: money,
          shop_deduction: shop_deduction != undefined ? shop_deduction : 0.0
        })
      }

      that.setData({
        currentpage: 1
      })
      that.http_shoplist();
    });
  },
  imageTap: function (event) {
    var code = event.currentTarget.dataset.code;
    wx.navigateTo({
      url: '../shouye/specialDetail/specialDetail?' + "class_code=" + code
    })
  },
  shopTap: function (event) {
    var shopcode = event.currentTarget.dataset.shop_code;
    var url = '../shouye/detail/detail?' + "shop_code=" + shopcode;
    if(this.data.roll_code)
    {
      url = '../shouye/detail/detail?' + "shop_code=" + shopcode + '&roll_code=' + this.data.roll_code + "&isFirst=" + this.data.isFirst + "&isNew=" + this.data.isNew + '&is_redHongBao=true';
    }
    url = url + '&shouYePage=' + this.data.shouYePage + '&poplastTime=' + this.data.poplastTime + '&homePage3ElasticFrame=' + this.data.homePage3ElasticFrame + '&comefrom=' + this.data.comefrom + '&task_freeling=' + this.data.task_freeling;
    wx.navigateTo({
      url: url,
    })
  },
  //å•†å“åˆ†ç±»
  typeTap: function () {
    console.log('å•†å“åˆ†ç±»');
    wx.navigateTo({
      url: '../shouye/shopClassType/shopClassType',
      // url:'../shouye/indianaRecord/indianaRecord',
    })
  },

  //æœç´¢
  searchClickEvent: function () {
    console.log('å•†å“æœç´¢');
    wx.navigateTo({
      url: '../shopType/shopSearch/shopSearch',
    })
  },
  //èµšé’±é¡µ
  moneytap: function () {
    wx.navigateTo({
      url: '../sign/sign',
    })
  },
  wxSerchFocus: function () {
    wx.navigateTo({
      url: '../shopType/shopSearch/shopSearch',
    })
  },
  searchInputEvent: function () {

  },
  //é‡æ–°å¤„ç†æ•°æ®
  newshoplist: function (obj) {
    var that = this;
    for (var k = 0; k < obj.length; k++) {
      var shops = obj[k];
      if (shops.shop_type_list.length) {
        var shop_type_lists = shops.shop_type_list[0].list;
        for (var i = 0; i < shop_type_lists.length; i++) {
          var newshopname = shop_type_lists[i].shop_name;
          if (newshopname.length > 6) {
            newshopname = '... ' + newshopname.substr(newshopname.length - 6, 6);
          }

          var code = shop_type_lists[i].shop_code.substr(1, 3);
          var new_pic = code + '/' + shop_type_lists[i].shop_code + '/' + shop_type_lists[i].def_pic;

          var shop_se_price = (shop_type_lists[i].shop_se_price).toFixed(1);
          obj[k].shop_type_list[0].list[i].shop_name = newshopname;
          obj[k].shop_type_list[0].list[i]["new_def_pic"] = new_pic;
          obj[k].shop_type_list[0].list[i]["new_shop_se_price"] = shop_se_price;
        }
      }
    }
    var pageData = this.data.pageData;
    for (var j = 0; j < obj.length; j++) {
      pageData.push(obj[j]);
    }
    this.setData({
      postlist: pageData,
      pageData: pageData,
    })
  },
  //è¯·æ±‚è½åœ°é¡µ è·å–å¾®ä¿¡å°ç¨‹åºè½åœ°é¡µå¼€å…³
  http_Landingpage2: function () {
    var token = "";
    if (app.globalData.user != null) {
      token = app.globalData.user.userToken;
      var url = config.Host + 'cfg/getCurrWxcxType?token=' + token + config.Version;
      util.http(url, this.Landingpage2);
    }
  },

  Landingpage2: function (data) {
    if (data.status == 1) {
      var shouyecount = data.data;

      if (shouyecount == 0) {
        this.setData({ isShowMakeMoney: false });
      } else
        this.setData({ isShowMakeMoney: true });
      app.globalData.user["shouyecount"] = shouyecount;
      isautoSign = false;
    }
  },
  //æ¯ç§’å‡ä¸€æ¬¡
  startReportHeart: function () {
    var that = this;
    var poplastTime = that.data.poplastTime;
    redhongbaoCutdoenTimer = setTimeout(function () {
      poplastTime--;
      that.data.poplastTime = poplastTime;
      wx.setStorageSync('poplastTime', that.data.poplastTime);
      that.startReportHeart()
    }, 1000)
  },
  onShow: function () { //åœ¨onShowä¸­å¤„ç†æ–°è¡£èŠ‚å¼¹çª—
    var that = this;
    try {
      isCrazyMon = wx.getStorageSync("HASMOD")
    } catch (e) {
    }

    //å¤§ä¿ƒé”€å·²ç»“æŸ
    if (app.globalData.user != null) {
      var showendofpromotionDialog = app.globalData.user.showSpecialPage != 1 ? true : false;
      that.setData({
        showMainPage:true,
        showendofpromotionDialog: showendofpromotionDialog
      })
    }else{
      that.setData({
        showMainPage: true,
        showendofpromotionDialog: true
      })
    }

    wx.onUserCaptureScreen(function (res) {
      console.log('â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ç”¨æˆ·æˆªå±äº†')
      that.showModal();
    })

    that.http_Landingpage2();

    that.setData({
      suspensionHongBao_isShow:false
    })
    that.xuanfuHongBaoAnimation();

    // this.http_shoplist();

    // isCrazyMon =  true;
    //æ–°è¡£èŠ‚å¼¹çª—è‡ªåŠ¨å¼¹å‡ºï¼Œæ¯å¤©åªå¼¹ä¸€æ¬¡
    var time = wx.getStorageSync("XINYIJIEZIDONGTANCHU");
    if (util.isToday(time) != "å½“å¤©" && isCrazyMon) {
      that.setData({
        showNewYI: true
      })
      wx.setStorageSync("XINYIJIEZIDONGTANCHU", new Date().getTime())
    } else {//çº¢åŒ…å¼¹æ¡†
      var showtime = wx.getStorageSync("redshow");
      var token = "";
      if (app.globalData.user != null) {
        token = app.globalData.user.userToken;
      }
      if (util.isToday(showtime) != "å½“å¤©" && isautoSign == false && token != null && token != "") {
        wx.setStorageSync("redshow", new Date().getTime());
        that.setData({
          isRedShow: true
        })
      }
    }

    //æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦æˆæƒ æœªæˆæƒå¼¹æˆæƒæç¤ºå¼¹çª—
    wx.getSetting({
      success: res => {
        // console.log(res);
        if (res.authSetting['scope.userInfo']) {
          // å·²ç»æˆæƒï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ getUserInfo è·å–å¤´åƒæ˜µç§°ï¼Œä¸ä¼šå¼¹æ¡†

          app.New_userlogin(function () {
            that.http_Landingpage2();
            if (!that.data.showNewYI && !that.data.isRedShow) {
              if (app.globalData.user != null) {
                that.getOrderStatus();
              }
            }
          });
        } else {

        }
      }
    })

    if (!firstComming && that.data.homePage3ElasticFrame > 0)
    {
      if (app.globalData.user != null && app.globalData.user.userToken != undefined) {
        return;
      }
      showHongBao.getShowHongbao(that, function (is_show) {
        if (is_show) {
          that.setData({
            redHongbaoNewuserShow: true
          })
        }
      });
    }
    firstComming = false;
  },
 
  //å•†å“è¯¦æƒ…
  first_list_tap: function (event) {
    var shopcode = event.currentTarget.dataset.shop_code;
    var url = '';
    if (this.data.curTabId == 'news')//æ—¶å°š
    {
      if (this.data.roll_code)
      {
        url = '../shouye/detail/detail?' + "shop_code=" + shopcode + '&roll_code=' + this.data.roll_code + "&isFirst=" + this.data.isFirst + "&isNew=" + this.data.isNew + '&is_redHongBao=true';
      }else{
        url = '../shouye/detail/detail?' + "shop_code=" + shopcode + "&isFirst=" + this.data.isFirst + "&isNew=" + this.data.isNew
      }

      if (app.globalData.oneYuanData != 0)//æ´»åŠ¨å•†å“
      {
        url = '../shouye/detail/detail?' + "shop_code=" + shopcode + "&isActiveShop=" + isActiveShop
      }
    } else {
      //shop_type 2ç‰¹ä»·å•†å“ 3ç‰¹ä»·å¹¿å‘Šå•†å“
      if(this.data.roll_code)
      {
        url = '../shouye/detail/detail?' + "shop_code=" + shopcode + "&shop_type=2" + '&roll_code=' + this.data.roll_code + "&isFirst=" + this.data.isFirst + "&isNew=" + this.data.isNew + '&is_redHongBao=true';
      }else{
        if(this.data.shouYePage == 'FourPage')
        {
          url = '../shouye/detail/detail?' + "shop_code=" + shopcode + "&shop_type=3";
        }else{
          url = '../shouye/detail/detail?' + "shop_code=" + shopcode + "&shop_type=2";
        }
      }
    }
    var freelingpage2_comefrom = urlcomefrom == 'homePage2FreeShop' ? true:false;

    url = url + '&shouYePage=' + this.data.shouYePage + '&poplastTime=' + this.data.poplastTime + '&homePage3ElasticFrame=' + this.data.homePage3ElasticFrame + '&comefrom=' + this.data.comefrom + '&task_freeling=' + this.data.task_freeling + '&freelingpage2_comefrom=' + freelingpage2_comefrom;
    wx.navigateTo({
      url: url,
    })
  },
  //æ–°è¡£èŠ‚å…³é—­æŒ‰é’®
  newYiCloseTap: function () {
    this.setData({
      showNewYI: false
    })
  },
  //æ–°è¡£èŠ‚å¼¹çª—-è·å–æŠ½å¥–æœºä¼šç‚¹å‡»
  newYIgoTap: function () {
    wx.navigateTo({
      url: '../sign/newYiListPage/newYiListPage',
    })
  },
  //æ–°è¡£èŠ‚å¼¹çª—æ´»åŠ¨è¯¦æƒ…ç‚¹å‡»
  newYIxiangqingTap: function () {

    this.setData({
      showNewYI: false
    })
    wx.navigateTo({
      url: '../sign/newYiHDXQ/newYiHDXQ',
    })
  },

  //çº¢åŒ…å¼¹çª—ç‚¹å‡»
  redtap: function () {
    this.setData({
      isRedShow: false
    })
    wx.navigateTo({
      url: '../sign/sign',
    })
  },

  //æ‹¼å›¢æˆåŠŸå¼¹çª—
  getFight: function () {

    wx.navigateTo({
      url: '../mine/order/order?indexid=' + 2,
    })
    this.setData({
      openFightSuccessShow: false
    })
    console.log("æ‹¼å›¢æˆåŠŸ");
  },
  closeFight: function () {
    this.setData({
      openFightSuccessShow: false
    })

    util.get_discountHttp(this.discountData);
  },

  //æ‹¼å›¢å¤±è´¥é€€æ¬¾å¼¹çª—
  discountData: function (data) {
    console.log(data);
    if (data.status == 1 && data.isFail == 1) {
      this.setData({
        moneyDiscountShowFlag: true,
        moneyDiscount: data.order_price
      })
    }
  },
  //æŸ¥çœ‹è®¢å•
  getYiDouBtn: function () {
    wx.navigateTo({
      url: '../mine/order/order?indexid=' + 0,
    })
    this.setData({
      moneyDiscountShowFlag: false
    })
  },
  //ç‚¹æŸ¥çœ‹ä½™é¢
  getYueBtn: function () {
    wx.navigateTo({
      url: '../mine/wallet/wallet',
    })
    this.setData({
      moneyDiscountShowFlag: false
    })
  },
  closeYiDouBtn: function () {
    this.setData({
      moneyDiscountShowFlag: false
    })
  },
  colseTips: function () {
    var that = this;
    if (that.data.contactkefuShow) {
      if (that.data.homePage3ElasticFrame == undefined || that.data.homePage3ElasticFrame <= 0) {
        if (app.globalData.user != null && app.globalData.user.userToken != undefined) {

        } else {//å½“ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆæƒæ—¶æ‰å¾ªç¯å¼¹å‡ºæ­¤æ¡†
          that.pop_redhongbao_newuser();
        }
      } else {
        that.data.poplastTime = that.data.homePage3ElasticFrame;
        that.startReportHeart();

        if (app.globalData.user != null && app.globalData.user.userToken != undefined) {
          clearInterval(redhongbaoCutdoenTimer);
          clearTimeout(redhongbaopopTimer);//æ¸…é™¤å®šæ—¶å™¨
        } else {//å½“ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆæƒæ—¶æ‰å¾ªç¯å¼¹å‡ºæ­¤æ¡†
          redhongbaopopTimer = setTimeout(function () {
            that.setData({
              redHongbaoNewuserShow: true,
            })
          }, that.data.homePage3ElasticFrame * 1000)
        }
      }
    }
    that.setData({
      contactkefuShow: false
    })
  },
  contactkefu: function () {
    if (this.data.contactkefuShow)
    {
      //å¦‚æœå–åˆ°å¹¿å‘Šclick_idå°±å›ä¼ 
      var click_id = wx.getStorageSync('gdt_vid');
      if (click_id) {
        var clickUrl = config.Host + 'wxMarkting/marketing_reservation?' + config.Version +
          '&click_id=' + click_id +
          "&channel=" + wx.getStorageSync("advent_channel");
        util.http(clickUrl, function (data) {
          if (data.status == 1) {
            wx.setStorageSync('gdt_vid', '')
          }
        });
      }
      this.setData({
        poplastTime:0,
        contactkefuShow: false
      })
    }
  },
  //çº¢åŒ…å€’è®¡æ—¶
  countdown: function () {
    var that = this;
    that.dateformat(total_micro_second);
    if (total_micro_second <= 0 || this.data.load_timer == false) {
      //æ—¶é—´æˆªè‡³
      that.setData({
        clock_hr: "00",
        clock_min: "00",
        clock_ss: "00",
      });
      return;
    }

    setTimeout(function () {
      total_micro_second -= 1000;
      that.countdown();
    }
      , 1000)
  },

  dateformat: function (micro_second) {

    var that = this;
    // æ€»ç§’æ•°
    var second = Math.floor(micro_second / 1000);

    // å¤©æ•°
    var day = "" + Math.floor(second / 3600 / 24);
    // å°æ—¶
    var hr = "" + Math.floor(second / 3600 % 24);
    // åˆ†é’Ÿ
    var min = "" + Math.floor(second / 60 % 60);
    // ç§’
    var sec = "" + Math.floor(second % 60);

    if (hr.length < 2) {
      hr = '0' + hr;
    }

    if (min.length < 2) {
      min = '0' + min;
    }

    if (sec.length < 2) {
      sec = '0' + sec;
    }
    that.setData({
      clock_hr: hr,
      clock_min: min,
      clock_ss: sec,
    });
  },

  //åˆ†äº«å¼¹çª—
  sharesubmit: function (e) {
    this.setData({
      getHongBaoSuccessShow: false
    })
    formId = e.detail.formId;
    util.httpPushFormId(formId);
  },
  //å…³é—­åˆ†äº«å¼¹çª—
  closeShare:function(){
    this.setData({
      getHongBaoSuccessShow: false
    })
  },
  /**
   * ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
   */
  onShareAppMessage: function () {
   
    var user_id = app.globalData.user?app.globalData.user.user_id:'';
    var headpic = "https://www.measures.wang/userinfo/head_pic/default.jpg";
    if ((app.globalData.user != null)) {
      headpic = (app.globalData.user.pic != null) ? app.globalData.user.pic : 'https://www.measures.wang/userinfo/head_pic/default.jpg'
    }
    var title = "æˆ‘åˆšé¢†çš„çº¢åŒ…ä¹Ÿåˆ†ä½ ä¸€ä¸ªï¼Œå¸®æˆ‘æç°å°±èƒ½æ‹¿é’±å“¦~";
    var imagestr = "small-iconImages/qingfengpic/newuser_redpackage_share.png";
    var path = '/pages/shouye/redHongBao?shouYePage=ThreePage' + "&isShareFlag=true" + "&user_id=" + user_id + "&headpic=" + headpic;
    if(scene != undefined && scene != "")
    {
      title = "199å…ƒè´­ç‰©çº¢åŒ…å…è´¹æŠ¢ï¼Œå¤šå¹³å°å¯ç”¨ï¼Œå¿«æ¥è¯•è¯•äººå“å§	ğŸ‘‰";
      imagestr = "small-iconImages/heboImg/freeling_share199yuan.jpg";
      path = '/pages/shouye/redHongBao?shouYePage=ThreePage' + "&isShareFlag=true" + "&user_id=" + user_id + "&headpic=" + headpic + "&scene=" + scene;
    }else if(this.data.testShare){
      title = "90å…ƒå¾®ä¿¡çº¢åŒ…ï¼Œç›´æ¥æ‰“å…¥å¾®ä¿¡é›¶é’±ï¼Œç‚¹å‡»é¢†å– ğŸ‘†";
      imagestr = "small-iconImages/heboImg/shareuserredhongbao_ninety_money.png";
      path = '/pages/shouye/redHongBao?shouYePage=ThreePage' + "&isShareFlag=true" + "&user_id=" + user_id + "&headpic=" + headpic;
    }
    return {
      title: title,
      path: path,
      imageUrl: config.Upyun + imagestr,
      success: function (res) {

      },
      fail: function (res) {
        // è½¬å‘å¤±è´¥
      }
    }
  },

  //æ»‘åŠ¨å¼€å§‹äº‹ä»¶
  handletouchtart: function (event) {
    this.data.lastX = event.touches[0].pageX
    this.data.lastY = event.touches[0].pageY
  },

  //æ»‘åŠ¨ç§»åŠ¨äº‹ä»¶
  handletouchmove: function (event) {

    console.log("*****************", event.touches[0]);
    var currentX = event.touches[0].pageX
    var currentY = event.touches[0].pageY
    var clientY = event.touches[0].clientY
    var tx = currentX - this.data.lastX
    var ty = currentY - this.data.lastY

    //å°†å½“å‰åæ ‡è¿›è¡Œä¿å­˜ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡è®¡ç®—
    var aaa = currentY / 500
    var text = ""
    if (ty < -14) {
      text = "å‘ä¸Šæ»‘åŠ¨"
    } else {
      text = "å‘ä¸‹æ»‘åŠ¨"
      if (currentY - clientY < 100) {
        aaa = 0;
      }
    }
    this.setData({
      aph: aaa
    });
  },

  //æ¨¡æ‹Ÿtab
  tabtap: function (e) {
    console.log('ok');
    var index = e.currentTarget.dataset.index;
    var path = this.data.pathlist[index];
    wx.switchTab({
      url: path,
    })
  },

  closeNewThirty:function(){
    var that = this;
    if (that.data.redHongbaoNewuserShow)
    {
      that.setData({
        redHongbaoNewuserShow: false
      })
      showHongBao.loopShowHongbao(that, showHongBao, function (is_show) {
        if (is_show) {
          that.setData({
            redHongbaoNewuserShow: true
          })
        }
      })
    }
    that.setData({
      redHongbaoQRcodeYiFuShow:false,
      redHongbaoNewuserShow:false,
      upperGoYiFuShow_task: false,
      upperGoYiFuShow_tixian: false,
      isQRcodeYiFuShow:false,
      hasJYJLdialog:false
    })
  },

  //å…³é—­ä¼šå‘˜å¼¹æ¡†
  hasJYJLtoSign: function () {
    wx.navigateTo({
      url: '../sign/sign',
    })
    this.setData({
      hasJYJLdialog: false
    })
  },
  
  closePop:function(){
    this.setData({
      freelingShowTips:false
    })
  },

  //çº¢åŒ…ç¼©æ”¾åŠ¨ç”»
  hongBaoAnimation: function () {
    var circleCount = 0;
    // å¿ƒè·³çš„å¤–æ¡†åŠ¨ç”»  
    this.animationMiddleHeaderItem = wx.createAnimation({
      duration: 500, // ä»¥æ¯«ç§’ä¸ºå•ä½  
      timingFunction: 'linear',
      delay: 100,
      transformOrigin: '50% 50%',
      success: function (res) {
        console.log("***************************");
      }
    });
    animationTimer = setInterval(function () {
      if (circleCount % 2 == 0) {
        this.animationMiddleHeaderItem.scale(1.15).step();
      } else {
        this.animationMiddleHeaderItem.scale(1.0).step();
      }

      this.setData({
        animationMiddleHeaderItem: this.animationMiddleHeaderItem.export() //è¾“å‡ºåŠ¨ç”»
      });

      circleCount++;
      if (circleCount == 1000) {
        circleCount = 0;
      }
    }.bind(this), 500);
  },
  //çº¢åŒ…æ‘‡æ‘†åŠ¨ç”»
  xuanfuHongBaoAnimation: function () {

    this.xuanfuanimationMiddleHeaderItem = wx.createAnimation({
      duration: 2000,    // ä»¥æ¯«ç§’ä¸ºå•ä½  
      timingFunction: 'linear',
      delay: 50,
      transformOrigin: '50% 50%',
      success: function (res) {
        console.log("***************************");
      }
    });
    xuanfuanimationTimer = setInterval(function () {
      this.xuanfuanimationMiddleHeaderItem.scale(1.2).step({ duration: 300 }).rotate(-15).step({ duration: 300 }).rotate(15).step({ duration: 300 }).rotate(0).step({ duration: 300 }).scale(1.0).step({ duration: 300 });

      this.setData({
        xuanfuanimationMiddleHeaderItem: this.xuanfuanimationMiddleHeaderItem.export()  //è¾“å‡ºåŠ¨ç”»
      });

    }.bind(this), 2000);
  },

  // æ˜¾ç¤ºé®ç½©å±‚
  showModal: function () {
    var that = this;
    that.setData({
      hideModal: false
    })
    var animation = wx.createAnimation({
      duration: 600,//åŠ¨ç”»çš„æŒç»­æ—¶é—´ é»˜è®¤600ms   æ•°å€¼è¶Šå¤§ï¼ŒåŠ¨ç”»è¶Šæ…¢   æ•°å€¼è¶Šå°ï¼ŒåŠ¨ç”»è¶Šå¿«
      timingFunction: 'ease',//åŠ¨ç”»çš„æ•ˆæœ é»˜è®¤å€¼æ˜¯linear
    })
    this.animation = animation
    setTimeout(function () {
      that.fadeIn();//è°ƒç”¨æ˜¾ç¤ºåŠ¨ç”»
    }, 200)
  },

  // éšè—é®ç½©å±‚
  hideModal: function () {
    var that = this;
    var animation = wx.createAnimation({
      duration: 800,//åŠ¨ç”»çš„æŒç»­æ—¶é—´ é»˜è®¤800ms   æ•°å€¼è¶Šå¤§ï¼ŒåŠ¨ç”»è¶Šæ…¢   æ•°å€¼è¶Šå°ï¼ŒåŠ¨ç”»è¶Šå¿«
      timingFunction: 'ease',//åŠ¨ç”»çš„æ•ˆæœ é»˜è®¤å€¼æ˜¯linear
    })
    this.animation = animation
    that.fadeDown();//è°ƒç”¨éšè—åŠ¨ç”»   
    setTimeout(function () {
      that.setData({
        hideModal: true
      })
    }, 500)//å…ˆæ‰§è¡Œä¸‹æ»‘åŠ¨ç”»ï¼Œå†éšè—æ¨¡å—

  },

  //åŠ¨ç”»é›†
  fadeIn: function () {
    this.animation.translateY(0).step()
    this.setData({
      animationData: this.animation.export()//åŠ¨ç”»å®ä¾‹çš„exportæ–¹æ³•å¯¼å‡ºåŠ¨ç”»æ•°æ®ä¼ é€’ç»™ç»„ä»¶çš„animationå±æ€§
    })
  },
  fadeDown: function () {
    this.animation.translateY(600).step()
    this.setData({
      animationData: this.animation.export(),
    })
  },

  //ç‚¹å‡»åé¦ˆå†…å®¹
  itemtap: function (e) {
    var clciktext = e.currentTarget.dataset.id;
    if (clciktext == "åé¦ˆä¸æŠ•è¯‰") {
      console.log('clciktext=', clciktext);
      this.setData({
        hideModal: true
      })
      wx.navigateTo({
        url: '/pages/mine/Complaint/Complaint?path=/inviteFriends/memberFriendsReward',
      })
    }
  },
  //æŠ•è¯‰åˆ†äº«
  complain_shareTap: function () {
    this.setData({
      hideModal: true
    })
  },

  footerTap: app.footerTap
})
